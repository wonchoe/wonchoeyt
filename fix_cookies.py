#!/usr/bin/env python3
"""
–ö–æ–Ω–≤–µ—Ä—Ç—É—î cookies –∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É –≤ Netscape —Ñ–æ—Ä–º–∞—Ç
"""

import sys
import re

def fix_cookies(input_file, output_file):
    """–ö–æ–Ω–≤–µ—Ä—Ç—É—î cookies –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π Netscape —Ñ–æ—Ä–º–∞—Ç"""
    
    with open(input_file, 'r') as f:
        content = f.read()
    
    fixed_lines = []
    fixed_lines.append("# Netscape HTTP Cookie File\n")
    fixed_lines.append("# This file was generated by fix_cookies.py\n")
    
    for line in content.split('\n'):
        line = line.strip()
        
        # Skip empty lines and comments
        if not line or line.startswith('#'):
            continue
        
        # Parse cookies - —Ñ–æ—Ä–º–∞—Ç: domain\tTRUE\t/\tTRUE\texpiration\tname\tvalue
        # –ê–ª–µ —É –≤–∞—Å –≤—Å–µ –≤ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É –∑ –ø—Ä–æ–±—ñ–ª–∞–º–∏
        
        # –†–æ–∑–±–∏–≤–∞—î–º–æ –ø–æ —Ç–∞–±—É–ª—è—Ü—ñ—ó –∞–±–æ –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö –ø—Ä–æ–±—ñ–ª–∞—Ö
        parts = re.split(r'\t+|\s{2,}', line)
        
        if len(parts) >= 7:
            domain = parts[0]
            flag = parts[1] if parts[1] in ['TRUE', 'FALSE'] else 'TRUE'
            path = parts[2]
            secure = parts[3] if parts[3] in ['TRUE', 'FALSE'] else 'FALSE'
            expiration = parts[4]
            name = parts[5]
            # Value –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –ø—Ä–æ–±—ñ–ª–∏, —Ç–æ–º—É –±–µ—Ä–µ–º–æ –≤—Å–µ —â–æ –∑–∞–ª–∏—à–∏–ª–æ—Å—å
            value = '\t'.join(parts[6:]) if len(parts) > 7 else parts[6]
            
            # –í–∏–¥–∞–ª—è—î–º–æ \n –∑ –∫—ñ–Ω—Ü—è value —è–∫—â–æ —î
            value = value.rstrip('\n')
            
            # –§–æ—Ä–º—É—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ä—è–¥–æ–∫
            fixed_line = f"{domain}\t{flag}\t{path}\t{secure}\t{expiration}\t{name}\t{value}\n"
            fixed_lines.append(fixed_line)
            print(f"‚úÖ Fixed: {name}")
        else:
            print(f"‚ö†Ô∏è  Skipped invalid line: {line[:50]}...")
    
    with open(output_file, 'w') as f:
        f.writelines(fixed_lines)
    
    print(f"\n‚úÖ Fixed {len(fixed_lines) - 2} cookies")
    print(f"üìù Output: {output_file}")

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("Usage: python fix_cookies.py <input_file> <output_file>")
        print("Example: python fix_cookies.py /tmp/cookies.txt /tmp/cookies_fixed.txt")
        sys.exit(1)
    
    fix_cookies(sys.argv[1], sys.argv[2])
